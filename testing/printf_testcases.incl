    {

/* Be afraid. Be very afraid.
   Virtually everything in the printf() / scanf() test drivers is heavily
   depending on the platform, i.e. the width of the integer values. Since
   we need widths, string representations in hex, octal and decimal and
   whatnot, there is some heavy macro abuse coming up...
*/

#define sym2v( x ) #x
#define sym2s( x ) sym2v( x )

#if INT_MAX >> 15 == 1

#define UINT_DIG 5
#define INT_DIG  5
#define INT_DIG_LESS1 "4"
#define INT_DIG_PLUS1 "6"
#define INT_DIG_PLUS2 "7"
#define INT_HEXDIG "FFF"
#define INT_hexdig "fff"
#define INT_OCTDIG "177777"
#define INT_MAX_DEZ_STR  "32767"
#define INT_MIN_DEZ_STR  "32768"
#define UINT_MAX_DEZ_STR "65535"
#define INT_MAX_OCT_STR
#define INT_MIN_OCT_STR
#define UINT_MAX_OCT_STR
#define INT_MAX_HEX_STR
#define INT_MIN_HEX_STR
#define UINT_MAX_HEX_STR

#elif UINT_MAX >> 31 == 1

#define UINT_DIG 10
#define INT_DIG  10
#define INT_DIG_LESS1 "9"
#define INT_DIG_PLUS1 "11"
#define INT_DIG_PLUS2 "12"
#define INT_HEXDIG "FFFFFFF"
#define INT_hexdig "fffffff"
#define INT_OCTDIG "37777777777"
#define INT_MAX_DEZ_STR  "2147483647"
#define INT_MIN_DEZ_STR  "2147483648"
#define UINT_MAX_DEZ_STR "4294967295"
#define INT_MAX_OCT_STR
#define INT_MIN_OCT_STR
#define UINT_MAX_OCT_STR
#define INT_MAX_HEX_STR
#define INT_MIN_HEX_STR
#define UINT_MAX_HEX_STR

#elif UINT_MAX >> 63 == 1

#define UINT_DIG 20
#define INT_DIG  19
#define INT_DIG_LESS1 "18"
#define INT_DIG_PLUS1 "20"
#define INT_DIG_PLUS2 "21"
#define INT_HEXDIG "FFFFFFFFFFFFFFF"
#define INT_hexdig "fffffffffffffff"
#define INT_OCTDIG "1777777777777777777777"
#define INT_MAX_DEZ_STR   "9223372036854775807"
#define INT_MIN_DEZ_STR   "9223372036854775808"
#define UINT_MAX_DEZ_STR "18446744073709551615"
#define INT_MAX_OCT_STR
#define INT_MIN_OCT_STR
#define UINT_MAX_OCT_STR
#define INT_MAX_HEX_STR
#define INT_MIN_HEX_STR
#define UINT_MAX_HEX_STR

#else

#error Unsupported width of 'int' (neither 16, 32, nor 64 bit).

#endif


#if ULONG_MAX >> 31 == 1

#define ULONG_DIG 10
#define LONG_DIG  10
#define LONG_MAX_DEZ_STR  "2147483647"
#define LONG_MIN_DEZ_STR  "2147483648"
#define ULONG_MAX_DEZ_STR "4294967295"
#define LONG_MAX_OCT_STR
#define LONG_MIN_OCT_STR
#define ULONG_MAX_OCT_STR
#define LONG_MAX_HEX_STR
#define LONG_MIN_HEX_STR
#define ULONG_MAX_HEX_STR

#elif ULONG_MAX >> 63 == 1

#define ULONG_DIG 20
#define LONG_DIG  19
#define LONG_MAX_DEZ_STR   "9223372036854775807"
#define LONG_MIN_DEZ_STR   "9223372036854775808"
#define ULONG_MAX_DEZ_STR "18446744073709551615"
#define LONG_MAX_OCT_STR
#define LONG_MIN_OCT_STR
#define ULONG_MAX_OCT_STR
#define LONG_MAX_HEX_STR
#define LONG_MIN_HEX_STR
#define ULONG_MAX_HEX_STR

#else

#error Unsupported width of 'long' (neither 32 nor 64 bit).

#endif


#if ULLONG_MAX >> 63 == 1

#define ULLONG_DIG 20
#define LLONG_DIG  19
#define LLONG_MAX_DEZ_STR   "9223372036854775807"
#define LLONG_MIN_DEZ_STR   "9223372036854775808"
#define ULLONG_MAX_DEZ_STR "18446744073709551615"
#define LLONG_MAX_OCT_STR
#define LLONG_MIN_OCT_STR
#define ULLONG_MAX_OCT_STR
#define LLONG_MAX_HEX_STR
#define LLONG_MIN_HEX_STR
#define ULLONG_MAX_HEX_STR

#elif ULLONG_MAX >> 127 == 1

#define ULLONG_DIG 38
#define LLONG_DIG  38
#define LLONG_MAX_DEZ_STR  "170141183460469231731687303715884105727"
#define LLONG_MIN_DEZ_STR  "170141183460469231731687303715884105728"
#define ULLONG_MAX_DEZ_STR "340282366920938463463374607431768211455"
#define LLONG_MAX_OCT_STR
#define LLONG_MIN_OCT_STR
#define ULLONG_MAX_OCT_STR
#define LLONG_MAX_HEX_STR
#define LLONG_MIN_HEX_STR
#define ULLONG_MAX_HEX_STR

#else

#error Unsupported width of 'long long' (neither 64 nor 128 bit).

#endif


    TESTCASE( testprintf( target, "%hhd", CHAR_MIN ) == 4 );
    TESTCASE_SPRINTF( "-128" );
    TESTCASE( testprintf( target, "%hhd", CHAR_MAX ) == 3 );
    TESTCASE_SPRINTF( "127" );
    TESTCASE( testprintf( target, "%hhd", 0 ) == 1 );
    TESTCASE_SPRINTF( "0" );
    TESTCASE( testprintf( target, "%hd", SHRT_MIN ) == 6 );
    TESTCASE_SPRINTF( "-32768" );
    TESTCASE( testprintf( target, "%hd", SHRT_MAX ) == 5 );
    TESTCASE_SPRINTF( "32767" );
    TESTCASE( testprintf( target, "%hd", 0 ) == 1 );
    TESTCASE_SPRINTF( "0" );
    TESTCASE( testprintf( target, "%d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%d", 0 ) == 1 );
    TESTCASE_SPRINTF( "0" );
    TESTCASE( testprintf( target, "%ld", LONG_MIN ) == LONG_DIG + 1 );
    TESTCASE_SPRINTF( "-" LONG_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%ld", LONG_MAX ) == LONG_DIG );
    TESTCASE_SPRINTF( LONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%ld", 0l ) == 1 );
    TESTCASE_SPRINTF( "0" );
    TESTCASE( testprintf( target, "%lld", LLONG_MIN ) == LLONG_DIG + 1 );
    TESTCASE_SPRINTF( "-" LLONG_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%lld", LLONG_MAX ) == LLONG_DIG );
    TESTCASE_SPRINTF( LLONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%lld", 0ll ) );
    TESTCASE_SPRINTF( "0" );
    TESTCASE( testprintf( target, "%hhu", UCHAR_MAX ) == 3 );
    TESTCASE_SPRINTF( "255" );
    TESTCASE( testprintf( target, "%hhu", (unsigned char)-1 ) == 3 );
    TESTCASE_SPRINTF( "255" );
    TESTCASE( testprintf( target, "%hu", USHRT_MAX ) == 5 );
    TESTCASE_SPRINTF( "65535" );
    TESTCASE( testprintf( target, "%hu", (unsigned short)-1 ) == 5 );
    TESTCASE_SPRINTF( "65535" );
    TESTCASE( testprintf( target, "%u", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%u", -1u ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%lu", ULONG_MAX ) == ULONG_DIG );
    TESTCASE_SPRINTF( ULONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%lu", -1ul ) == ULONG_DIG );
    TESTCASE_SPRINTF( ULONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%llu", ULLONG_MAX ) == ULLONG_DIG );
    TESTCASE_SPRINTF( ULLONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%llu", -1ull ) == ULLONG_DIG );
    TESTCASE_SPRINTF( ULLONG_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%X", UINT_MAX ) == (int)strlen( INT_HEXDIG ) + 1 );
    TESTCASE_SPRINTF( "F" INT_HEXDIG );
    TESTCASE( testprintf( target, "%#X", -1u ) == (int)strlen( INT_HEXDIG ) + 3 );
    TESTCASE_SPRINTF( "0XF" INT_HEXDIG );
    TESTCASE( testprintf( target, "%x", UINT_MAX ) == (int)strlen( INT_HEXDIG ) + 1 );
    TESTCASE_SPRINTF( "f" INT_hexdig );
    TESTCASE( testprintf( target, "%#x", -1u ) == (int)strlen( INT_HEXDIG ) + 3 );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%o", UINT_MAX ) == (int)strlen( INT_OCTDIG ) );
    TESTCASE_SPRINTF( INT_OCTDIG );
    TESTCASE( testprintf( target, "%#o", -1u ) == (int)strlen( INT_OCTDIG ) + 1 );
    TESTCASE_SPRINTF( "0" INT_OCTDIG );
#if 0
    /* TODO: This test case is broken, doesn't test what it was intended to. */
    TESTCASE( testprintf( target, "%.0#o", 0 ) == 5 );
    TESTCASE_SPRINTF( "%.0#o" );
#endif
    TESTCASE( testprintf( target, "%+d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%+d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%+d", 0 ) == 2 );
    TESTCASE_SPRINTF( "+0" );
    TESTCASE( testprintf( target, "%+u", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%+u", -1u ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "% d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "% d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( " " INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "% d", 0 ) == 2 );
    TESTCASE_SPRINTF( " 0" );
    TESTCASE( testprintf( target, "% u", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "% u", -1u ) == UINT_DIG );
    TESTCASE_SPRINTF( UINT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_LESS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_LESS1 "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%" sym2s(INT_DIG) "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%" sym2s(INT_DIG) "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_PLUS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_PLUS1 "d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( " " INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_PLUS2 "d", INT_MIN ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( " -" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%" INT_DIG_PLUS2 "d", INT_MAX ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "  " INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-" INT_DIG_LESS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-" INT_DIG_LESS1 "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-" sym2s(INT_DIG) "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-" sym2s(INT_DIG) "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-" INT_DIG_PLUS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-" INT_DIG_PLUS1 "d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR " " );
    TESTCASE( testprintf( target, "%-" INT_DIG_PLUS2 "d", INT_MIN ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR " " );
    TESTCASE( testprintf( target, "%-" INT_DIG_PLUS2 "d", INT_MAX ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR "  " );
    TESTCASE( testprintf( target, "%0" INT_DIG_LESS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%0" INT_DIG_LESS1 "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%0" sym2s(INT_DIG) "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%0" sym2s(INT_DIG) "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%0" INT_DIG_PLUS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%0" INT_DIG_PLUS1 "d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "0" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%0" INT_DIG_PLUS2 "d", INT_MIN ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "-0" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%0" INT_DIG_PLUS2 "d", INT_MAX ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "00" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" INT_DIG_LESS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" INT_DIG_LESS1 "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" sym2s(INT_DIG) "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" sym2s(INT_DIG) "d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" INT_DIG_PLUS1 "d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%-0" INT_DIG_PLUS1 "d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR " " );
    TESTCASE( testprintf( target, "%-0" INT_DIG_PLUS2 "d", INT_MIN ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR " " );
    TESTCASE( testprintf( target, "%-0" INT_DIG_PLUS2 "d", INT_MAX ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR "  " );
    /* FIXME: This test not yet 32/64 bit agnostic */
    TESTCASE( testprintf( target, "%030.20d", INT_MAX ) == 30 );
    TESTCASE_SPRINTF( "          00000000002147483647" );
    TESTCASE( testprintf( target, "%.6x", UINT_MAX ) == (int)strlen( INT_HEXDIG ) + 1 );
    TESTCASE_SPRINTF( "f" INT_hexdig );
    TESTCASE( testprintf( target, "%#6.3x", UINT_MAX ) == (int)strlen( INT_HEXDIG ) + 3 );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%#3.6x", UINT_MAX ) == (int)strlen( INT_HEXDIG ) + 3 );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%.6d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%6.3d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%3.6d", INT_MIN ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "-" INT_MIN_DEZ_STR );
    TESTCASE( testprintf( target, "%#0.6x", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%#06.3x", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%#03.6x", UINT_MAX ) == UINT_DIG );
    TESTCASE_SPRINTF( "0xf" INT_hexdig );
    TESTCASE( testprintf( target, "%#0.6d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%#06.3d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%#03.6d", INT_MAX ) == INT_DIG );
    TESTCASE_SPRINTF( INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%#+.6d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%#+6.3d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%#+3.6d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%+0.6d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%+06.3d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "%+03.6d", INT_MAX ) == INT_DIG + 1 );
    TESTCASE_SPRINTF( "+" INT_MAX_DEZ_STR );
#ifndef TEST_CONVERSION_ONLY
    TESTCASE( testprintf( target, "- %d", INT_MAX ) == INT_DIG + 2 );
    TESTCASE_SPRINTF( "- " INT_MAX_DEZ_STR );
    TESTCASE( testprintf( target, "- %d %% %d", INT_MAX, INT_MIN ) == INT_DIG * 2 + 6 );
    TESTCASE_SPRINTF( "- " INT_MAX_DEZ_STR " % -" INT_MIN_DEZ_STR );
#endif
    TESTCASE( testprintf( target, "%c", 'x' ) == 1 );
    TESTCASE_SPRINTF( "x" );
    TESTCASE( testprintf( target, "%s", "abcdef" ) == 6 );
    TESTCASE_SPRINTF( "abcdef" );
    /* FIXME: This test not yet 32/64 bit agnostic */
    TESTCASE( testprintf( target, "%p", (void *)0xdeadbeef ) == 10 );
    TESTCASE_SPRINTF( "0xdeadbeef" );
    TESTCASE( testprintf( target, "%#6x", 1 ) == 6 );
    TESTCASE_SPRINTF( "   0x1" );
#ifndef TEST_CONVERSION_ONLY
    {
        int val1, val2;
        TESTCASE( testprintf( target, "123456%n789%n", &val1, &val2 ) == 9 );
        TESTCASE_SPRINTF( "123456789" ); /* FIXME */
        TESTCASE( val1 == 6 );
        TESTCASE( val2 == 9 );
    }
#endif
    }
